<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: ffi | 心静茹水]]></title>
  <link href="http://proudxu.github.com/tags/ffi/atom.xml" rel="self"/>
  <link href="http://proudxu.github.com/"/>
  <updated>2012-12-25T10:13:29+08:00</updated>
  <id>http://proudxu.github.com/</id>
  <author>
    <name><![CDATA[Zhao, Xuhai]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Lua中通过ffi调用c的结构体变量]]></title>
    <link href="http://proudxu.github.com/blog/2012/12/24/lua-struct/"/>
    <updated>2012-12-24T18:08:00+08:00</updated>
    <id>http://proudxu.github.com/blog/2012/12/24/lua-struct</id>
    <content type="html"><![CDATA[<p>``` c
local ffi = require("ffi")
ffi.cdef[[
   typedef struct {</p>

<pre><code> uint8_t id;
 char * name; 
</code></pre>

<p>   } stuInfo;
]]
local n = 1
local stu = ffi.new("stuInfo[?]", n)
for i=0, n-1 do
   stu[i].id = 1;
   local name = "zhao";
   local ptr=ffi.cast("char *", name);
   stu[i].name = ptr;
end</p>

<p>print(stu[0].id);
local myname = ffi.string(stu[0].name);
print(myname);
```</p>

<p>其中
```
ffi.cdef[[
   typedef struct {</p>

<pre><code> uint8_t id;
 char * name; 
</code></pre>

<p>   } stuInfo;
]]
```
表示新建一个结构体</p>

<pre><code>local stu = ffi.new("stuInfo[?]", n)
</code></pre>

<p>新建变长的结构体变量</p>

<pre><code>local ptr=ffi.cast("char *", name);
</code></pre>

<p>将lua中字符串转换为c的<code>char *</code></p>

<pre><code>local myname = ffi.string(stu[0].name);    
</code></pre>

<p>将c中<code>char *</code>类型转换为lua的字符串</p>
]]></content>
  </entry>
  
</feed>
